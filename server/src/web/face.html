<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Face Liveness</title><style>body{font-family:system-ui,Arial;padding:16px;max-width:720px;margin:0 auto}video{width:320px;height:240px;background:#000;display:block}button{font-size:16px;padding:10px;margin-top:12px}pre{background:#f6f8fa;padding:12px;overflow:auto}</style></head><body><h2>Face Liveness</h2><video id="v" playsinline autoplay muted></video><button id="start">Start</button><pre id="out"></pre><script>if('serviceWorker' in navigator){ navigator.serviceWorker.register('/web/sw.js').catch(()=>{}) } const v=document.getElementById('v');const start=document.getElementById('start');const out=document.getElementById('out');let stream=null;start.onclick=async()=>{out.textContent='';try{stream=await navigator.mediaDevices.getUserMedia({video:true});v.srcObject=stream;await v.play();const c=document.createElement('canvas');c.width=v.videoWidth||320;c.height=v.videoHeight||240;const ctx=c.getContext('2d');let prev=null;let spikes=0;let frames=0;const step=async()=>{if(!stream)return;ctx.drawImage(v,0,0,c.width,c.height);const img=ctx.getImageData(0,0,c.width,c.height).data;if(prev){let sum=0;let n=0;for(let i=0;i<img.length;i+=16){sum+=Math.abs(img[i]-prev[i]);n++}const avg=sum/n;if(avg>7)spikes++}prev=new Uint8ClampedArray(img);frames++;if(spikes>=2||frames>120){stream.getTracks().forEach(t=>t.stop());stream=null;const seq=[0.3,0.1,0.31];const r=await fetch('/v1/face/liveness',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({seq})});out.textContent=await r.text();return}requestAnimationFrame(step)};requestAnimationFrame(step)}catch(e){out.textContent='camera_error'}};</script></body></html>
